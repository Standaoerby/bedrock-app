#:import dp kivy.metrics.dp

<HomeScreen>:
    name: "home"
    
    BoxLayout:
        orientation: 'vertical'
        padding: [dp(16), dp(16), dp(16), dp(16)]
        spacing: dp(8)

        # Верхний блок: дата и будильник
        BoxLayout:
            orientation: 'horizontal'
            spacing: dp(8)
            size_hint_y: None
            height: dp(56)
            
            # Дата слева
            OverlayCard:
                size_hint_x: 0.65
                
                BoxLayout:
                    orientation: 'horizontal'
                    padding: [dp(16), dp(8)]
                    
                    Label:
                        id: date_label
                        text: root.current_date
                        font_size: '18sp'
                        font_name: app.theme_manager.get_font("main")
                        color: app.theme_manager.get_rgba("text")
                        halign: 'left'
                        valign: 'middle'
                        text_size: self.size

            # Будильник справа
            OverlayCard:
                size_hint_x: 0.35
                
                BoxLayout:
                    orientation: 'horizontal'
                    spacing: dp(8)
                    padding: [dp(8), dp(4)]

                    Label:
                        id: alarm_time_label
                        text: root.current_alarm_time
                        font_size: '16sp'
                        font_name: app.theme_manager.get_font("main")
                        color: app.theme_manager.get_rgba("primary") if root.alarm_active else app.theme_manager.get_rgba("text")
                        size_hint_x: 0.6
                        halign: 'center'
                        valign: 'middle'
                        text_size: self.size

                    Button:
                        id: alarm_toggle_btn
                        text: "ON" if root.alarm_active else "OFF"
                        font_size: '12sp'
                        font_name: app.theme_manager.get_font("main")
                        background_normal: app.theme_manager.get_image("button_bg")
                        background_down: app.theme_manager.get_image("button_bg_active")
                        color: app.theme_manager.get_rgba("text")
                        size_hint_x: 0.4
                        on_release: root.toggle_alarm()

        # Центральный блок с большими часами
        AnchorLayout:
            anchor_x: 'center'
            anchor_y: 'center'
            
            Label:
                id: clock_label
                text: root.clock_time
                font_size: '120sp'
                font_name: app.theme_manager.get_font("main")
                color: app.theme_manager.get_rgba("primary")
                size_hint: None, None
                size: self.texture_size
                halign: 'center'
                valign: 'middle'

        # Блок погоды
        OverlayCard:
            size_hint_y: None
            height: dp(64)
            
            BoxLayout:
                orientation: 'horizontal'
                spacing: dp(16)
                padding: [dp(16), dp(8)]

                # Текущая погода
                BoxLayout:
                    orientation: 'vertical'
                    size_hint_x: 0.6
                    
                    Label:
                        text: "Сейчас"
                        font_size: '14sp'
                        font_name: app.theme_manager.get_font("main")
                        color: app.theme_manager.get_rgba("text")
                        size_hint_y: 0.4
                        halign: 'left'
                        valign: 'bottom'
                        text_size: self.size
                    
                    Label:
                        id: weather_now_label
                        text: root.weather_now_str
                        font_size: '20sp'
                        font_name: app.theme_manager.get_font("main")
                        color: app.theme_manager.get_rgba("primary")
                        size_hint_y: 0.6
                        halign: 'left'
                        valign: 'top'
                        text_size: self.size

                # Прогноз через 5 часов
                BoxLayout:
                    orientation: 'vertical'
                    size_hint_x: 0.4
                    
                    Label:
                        text: "Через 5ч"
                        font_size: '14sp'
                        font_name: app.theme_manager.get_font("main")
                        color: app.theme_manager.get_rgba("text")
                        size_hint_y: 0.4
                        halign: 'right'
                        valign: 'bottom'
                        text_size: self.size
                    
                    BoxLayout:
                        orientation: 'horizontal'
                        size_hint_y: 0.6
                        spacing: dp(4)
                        
                        Label:
                            id: weather_5h_label
                            text: root.weather_5h_str
                            font_size: '18sp'
                            font_name: app.theme_manager.get_font("main")
                            color: app.theme_manager.get_rgba("text")
                            halign: 'right'
                            valign: 'top'
                            text_size: self.size
                            
                        Label:
                            id: weather_trend_label
                            text: root.weather_trend_arrow
                            font_size: '20sp'
                            font_name: app.theme_manager.get_font("main")
                            color: app.theme_manager.get_rgba("primary")
                            size_hint_x: None
                            width: dp(24)
                            halign: 'center'
                            valign: 'top'

        # Нижний блок с уведомлениями
        OverlayCard:
            size_hint_y: None
            height: dp(40)
            
            BoxLayout:
                orientation: 'horizontal'
                padding: [dp(16), dp(8)]
                
                Label:
                    text: "(!)"
                    font_size: '16sp'
                    size_hint_x: None
                    width: dp(32)
                    halign: 'center'
                    valign: 'middle'
                
                Label:
                    id: notification_text_label
                    text: root.notification_text or "Нет новых уведомлений"
                    font_size: '14sp'
                    font_name: app.theme_manager.get_font("main")
                    color: app.theme_manager.get_rgba("text")
                    halign: 'left'
                    valign: 'middle'
                    text_size: self.size
                    text_size: self.width, None