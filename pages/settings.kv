#:import dp kivy.metrics.dp

<SettingsScreen>:
    name: "settings"
    
    BoxLayout:
        orientation: 'vertical'
        padding: [dp(16), dp(16), dp(16), dp(16)]
        spacing: dp(12)

        # Верхний ряд: Тема и Язык
        BoxLayout:
            orientation: 'horizontal'
            spacing: dp(16)
            size_hint_y: None
            height: dp(248)
            
            # Настройки темы
            OverlayCard:
                size_hint_x: 0.6
                padding: [dp(16), dp(12)]
                
                BoxLayout:
                    orientation: 'vertical'
                    spacing: dp(16)
                    
                    Label:
                        id: theme_section_label
                        text: "Theme Settings"
                        font_size: '18sp'
                        font_name: app.theme_manager.get_font("title") if app.theme_manager else ""
                        color: app.theme_manager.get_rgba("primary") if app.theme_manager else [1,1,1,1]
                        size_hint_y: None
                        height: dp(24)
                        halign: 'center'
                        valign: 'middle'
                        text_size: self.size
                    
                    BoxLayout:
                        orientation: 'horizontal'
                        spacing: dp(8)
                        size_hint_y: None
                        height: dp(48)
                        
                        Label:
                            id: theme_label
                            text: "Theme:"
                            font_size: '16sp'
                            font_name: app.theme_manager.get_font("main") if app.theme_manager else ""
                            color: app.theme_manager.get_rgba("text") if app.theme_manager else [1,1,1,1]
                            size_hint_x: 0.3
                            halign: 'right'
                            valign: 'middle'
                            text_size: self.size
                        
                        Spinner:
                            id: theme_spinner
                            text: root.current_theme
                            values: ["minecraft"]
                            font_size: '16sp'
                            font_name: app.theme_manager.get_font("main") if app.theme_manager else ""
                            color: app.theme_manager.get_rgba("text") if app.theme_manager else [1,1,1,1]
                            background_normal: app.theme_manager.get_image("button_bg") if app.theme_manager else ""
                            background_down: app.theme_manager.get_image("button_bg_active") if app.theme_manager else ""
                            size_hint_x: 0.7
                            on_text: if self.text != root.current_theme: root.on_theme_select(self.text)
                    
                    BoxLayout:
                        orientation: 'horizontal'
                        spacing: dp(8)
                        size_hint_y: None
                        height: dp(48)
                        
                        Label:
                            id: variant_label
                            text: "Mode:"
                            font_size: '16sp'
                            font_name: app.theme_manager.get_font("main") if app.theme_manager else ""
                            color: app.theme_manager.get_rgba("text") if app.theme_manager else [1,1,1,1]
                            size_hint_x: 0.3
                            halign: 'right'
                            valign: 'middle'
                            text_size: self.size
                        
                        Spinner:
                            id: variant_spinner
                            text: root.current_variant
                            values: ["light", "dark"]
                            font_size: '16sp'
                            font_name: app.theme_manager.get_font("main") if app.theme_manager else ""
                            color: app.theme_manager.get_rgba("text") if app.theme_manager else [1,1,1,1]
                            background_normal: app.theme_manager.get_image("button_bg") if app.theme_manager else ""
                            background_down: app.theme_manager.get_image("button_bg_active") if app.theme_manager else ""
                            size_hint_x: 0.7
                            on_text: if self.text != root.current_variant: root.on_variant_select(self.text)
            
            # Настройки языка
            OverlayCard:
                size_hint_x: 0.4
                padding: [dp(16), dp(12)]
                
                BoxLayout:
                    orientation: 'vertical'
                    spacing: dp(16)
                    
                    Label:
                        id: language_section_label
                        text: "Localization"
                        font_size: '18sp'
                        font_name: app.theme_manager.get_font("title") if app.theme_manager else ""
                        color: app.theme_manager.get_rgba("primary") if app.theme_manager else [1,1,1,1]
                        size_hint_y: None
                        height: dp(24)
                        halign: 'center'
                        valign: 'middle'
                        text_size: self.size
                    
                    BoxLayout:
                        orientation: 'horizontal'
                        spacing: dp(8)
                        size_hint_y: None
                        height: dp(32)
                        
                        Label:
                            id: language_label
                            text: "Language:"
                            font_size: '14sp'
                            font_name: app.theme_manager.get_font("main") if app.theme_manager else ""
                            color: app.theme_manager.get_rgba("text") if app.theme_manager else [1,1,1,1]
                            size_hint_x: 0.4
                            halign: 'right'
                            valign: 'middle'
                            text_size: self.size
                        
                        Spinner:
                            id: language_spinner
                            text: root.current_language
                            values: ["en", "ru"]
                            font_size: '14sp'
                            font_name: app.theme_manager.get_font("main") if app.theme_manager else ""
                            color: app.theme_manager.get_rgba("text") if app.theme_manager else [1,1,1,1]
                            background_normal: app.theme_manager.get_image("button_bg") if app.theme_manager else ""
                            background_down: app.theme_manager.get_image("button_bg_active") if app.theme_manager else ""
                            size_hint_x: 0.6
                            on_text: if self.text != root.current_language: root.on_language_select(self.text)
                    
                    # Заполнитель
                    Widget:

        # Средний ряд: Пользователь и Автотема
        BoxLayout:
            orientation: 'horizontal'
            spacing: dp(16)
            size_hint_y: None
            height: dp(160)
            
            # Настройки пользователя
            OverlayCard:
                size_hint_x: 0.6
                padding: [dp(16), dp(12)]
                
                BoxLayout:
                    orientation: 'vertical'
                    spacing: dp(8)
                    
                    Label:
                        id: user_section_label
                        text: "User Settings"
                        font_size: '18sp'
                        font_name: app.theme_manager.get_font("title") if app.theme_manager else ""
                        color: app.theme_manager.get_rgba("primary") if app.theme_manager else [1,1,1,1]
                        size_hint_y: None
                        height: dp(24)
                        halign: 'center'
                        valign: 'middle'
                        text_size: self.size
                    
                    BoxLayout:
                        orientation: 'horizontal'
                        spacing: dp(8)
                        size_hint_y: None
                        height: dp(32)
                        
                        Label:
                            id: username_label
                            text: "Name:"
                            font_size: '18sp'
                            font_name: app.theme_manager.get_font("main") if app.theme_manager else ""
                            color: app.theme_manager.get_rgba("text") if app.theme_manager else [1,1,1,1]
                            size_hint_x: 0.25
                            halign: 'right'
                            valign: 'middle'
                            text_size: self.size
                        
                        TextInput:
                            id: username_input
                            text: root.username
                            font_size: '18sp'
                            font_name: app.theme_manager.get_font("main") if app.theme_manager else ""
                            foreground_color: app.theme_manager.get_rgba("text") if app.theme_manager else [1,1,1,1]
                            background_color: app.theme_manager.get_rgba("overlay_card") if app.theme_manager else [0.2,0.2,0.2,1]
                            size_hint_x: 0.75
                            multiline: False
                            height: dp(32)
                            on_text: root.on_username_change(self, self.text)
                    
                    BoxLayout:
                        orientation: 'horizontal'
                        spacing: dp(4)
                        size_hint_y: None
                        height: dp(32)
                        
                        Label:
                            id: birthday_label
                            text: "Birth:"
                            font_size: '18sp'
                            font_name: app.theme_manager.get_font("main") if app.theme_manager else ""
                            color: app.theme_manager.get_rgba("text") if app.theme_manager else [1,1,1,1]
                            size_hint_x: 0.25
                            halign: 'right'
                            valign: 'middle'
                            text_size: self.size
                        
                        TextInput:
                            id: birth_day_input
                            text: root.birth_day
                            font_size: '18sp'
                            font_name: app.theme_manager.get_font("main") if app.theme_manager else ""
                            foreground_color: app.theme_manager.get_rgba("text") if app.theme_manager else [1,1,1,1]
                            background_color: app.theme_manager.get_rgba("overlay_card") if app.theme_manager else [0.2,0.2,0.2,1]
                            size_hint_x: 0.15
                            multiline: False
                            input_filter: "int"
                            height: dp(32)
                            on_text: root.on_birth_day_change(self, self.text)
                        
                        Label:
                            text: "/"
                            font_size: '18sp'
                            color: app.theme_manager.get_rgba("text") if app.theme_manager else [1,1,1,1]
                            size_hint_x: 0.05
                            halign: 'center'
                        
                        TextInput:
                            id: birth_month_input
                            text: root.birth_month
                            font_size: '18sp'
                            font_name: app.theme_manager.get_font("main") if app.theme_manager else ""
                            foreground_color: app.theme_manager.get_rgba("text") if app.theme_manager else [1,1,1,1]
                            background_color: app.theme_manager.get_rgba("overlay_card") if app.theme_manager else [0.2,0.2,0.2,1]
                            size_hint_x: 0.15
                            multiline: False
                            input_filter: "int"
                            height: dp(32)
                            on_text: root.on_birth_month_change(self, self.text)
                        
                        Label:
                            text: "/"
                            font_size: '18sp'
                            color: app.theme_manager.get_rgba("text") if app.theme_manager else [1,1,1,1]
                            size_hint_x: 0.05
                            halign: 'center'
                        
                        TextInput:
                            id: birth_year_input
                            text: root.birth_year
                            font_size: '18sp'
                            font_name: app.theme_manager.get_font("main") if app.theme_manager else ""
                            foreground_color: app.theme_manager.get_rgba("text") if app.theme_manager else [1,1,1,1]
                            background_color: app.theme_manager.get_rgba("overlay_card") if app.theme_manager else [0.2,0.2,0.2,1]
                            size_hint_x: 0.3
                            multiline: False
                            input_filter: "int"
                            height: dp(32)
                            on_text: root.on_birth_year_change(self, self.text)
                    
                    # Заполнитель
                    Widget:
            
            # Автоматическая тема
            OverlayCard:
                size_hint_x: 0.4
                padding: [dp(16), dp(12)]
                
                BoxLayout:
                    orientation: 'vertical'
                    spacing: dp(8)
                    
                    Label:
                        id: auto_theme_section_label
                        text: "Auto Theme"
                        font_size: '18sp'
                        font_name: app.theme_manager.get_font("title") if app.theme_manager else ""
                        color: app.theme_manager.get_rgba("primary") if app.theme_manager else [1,1,1,1]
                        size_hint_y: None
                        height: dp(24)
                        halign: 'center'
                        valign: 'middle'
                        text_size: self.size
                    
                    BoxLayout:
                        orientation: 'horizontal'
                        spacing: dp(8)
                        size_hint_y: None
                        height: dp(32)
                        
                        Label:
                            id: auto_theme_label
                            text: "Auto:"
                            font_size: '14sp'
                            font_name: app.theme_manager.get_font("main") if app.theme_manager else ""
                            color: app.theme_manager.get_rgba("text") if app.theme_manager else [1,1,1,1]
                            size_hint_x: 0.4
                            halign: 'right'
                            valign: 'middle'
                            text_size: self.size
                        
                        Button:
                            id: auto_theme_button
                            text: "ON" if root.auto_theme_enabled else "OFF"
                            font_size: '14sp'
                            font_name: app.theme_manager.get_font("main") if app.theme_manager else ""
                            color: app.theme_manager.get_rgba("primary") if (app.theme_manager and root.auto_theme_enabled) else (app.theme_manager.get_rgba("text_secondary") if app.theme_manager else [0.7,0.7,0.7,1])
                            background_normal: app.theme_manager.get_image("button_bg") if app.theme_manager else ""
                            background_down: app.theme_manager.get_image("button_bg_active") if app.theme_manager else ""
                            size_hint_x: 0.6
                            disabled: not root.light_sensor_available
                            opacity: 1.0 if root.light_sensor_available else 0.5
                            on_release: root.toggle_auto_theme()
                    
                    BoxLayout:
                        orientation: 'horizontal'
                        spacing: dp(4)
                        size_hint_y: None
                        height: dp(24)
                        
                        Label:
                            id: threshold_label
                            text: "Delay:"
                            font_size: '12sp'
                            font_name: app.theme_manager.get_font("main") if app.theme_manager else ""
                            color: app.theme_manager.get_rgba("text_secondary") if app.theme_manager else [0.7,0.7,0.7,1]
                            size_hint_x: 0.3
                            halign: 'right'
                            valign: 'middle'
                            text_size: self.size
                        
                        Slider:
                            id: threshold_slider
                            min: 1
                            max: 5
                            value: root.light_sensor_threshold
                            step: 1
                            size_hint_x: 0.5
                            disabled: not root.light_sensor_available
                            on_value: root.on_threshold_change(self.value)
                        
                        Label:
                            text: f"{int(root.light_sensor_threshold)}s"
                            font_size: '12sp'
                            font_name: app.theme_manager.get_font("main") if app.theme_manager else ""
                            color: app.theme_manager.get_rgba("text_secondary") if app.theme_manager else [0.7,0.7,0.7,1]
                            size_hint_x: 0.2
                            halign: 'center'
                            valign: 'middle'
                    
                    Label:
                        id: sensor_status_label
                        text: root.current_light_status
                        font_size: '10sp'
                        font_name: app.theme_manager.get_font("main") if app.theme_manager else ""
                        color: app.theme_manager.get_rgba("text_secondary") if app.theme_manager else [0.7,0.7,0.7,1]
                        size_hint_y: None
                        height: dp(16)
                        halign: 'center'
                        valign: 'middle'
                        text_size: self.size

        # Нижний ряд: Кнопки управления
        OverlayCard:
            size_hint_y: None
            height: dp(64)
            padding: [dp(16), dp(8)]
            
            BoxLayout:
                orientation: 'horizontal'
                spacing: dp(16)
                
                Widget:
                    # Заполнитель для центрирования
                    size_hint_x: 0.4
                
                Button:
                    id: save_button
                    text: "Save Settings"
                    font_size: '16sp'
                    font_name: app.theme_manager.get_font("main") if app.theme_manager else ""
                    color: app.theme_manager.get_rgba("primary") if app.theme_manager else [1,1,1,1]
                    background_normal: app.theme_manager.get_image("button_bg") if app.theme_manager else ""
                    background_down: app.theme_manager.get_image("button_bg_active") if app.theme_manager else ""
                    size_hint_x: 0.3
                    on_release: root.save_all_settings()
                
                Widget:
                    # Заполнитель
                    size_hint_x: 0.3