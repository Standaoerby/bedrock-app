#:import dp kivy.metrics.dp

<SettingsScreen>:
    name: "settings"
    
    BoxLayout:
        orientation: 'vertical'
        padding: [dp(16), dp(16), dp(16), dp(16)]
        spacing: dp(8)

        # Верхний ряд: Тема и Язык
        BoxLayout:
            orientation: 'horizontal'
            spacing: dp(16)
            size_hint_y: None
            height: dp(120)
            
            # Настройки темы
            OverlayCard:
                size_hint_x: 0.6
                padding: [dp(16), dp(12)]
                
                BoxLayout:
                    orientation: 'vertical'
                    spacing: dp(8)
                    
                    Label:
                        id: theme_section_label
                        text: "Theme Settings"
                        font_size: '18sp'
                        font_name: app.theme_manager.get_font("title")
                        color: app.theme_manager.get_rgba("primary")
                        size_hint_y: None
                        height: dp(24)
                        halign: 'center'
                        valign: 'middle'
                        text_size: self.size
                    
                    BoxLayout:
                        orientation: 'horizontal'
                        spacing: dp(8)
                        size_hint_y: None
                        height: dp(32)
                        
                        Label:
                            id: theme_label
                            text: "Theme:"
                            font_size: '14sp'
                            font_name: app.theme_manager.get_font("main")
                            color: app.theme_manager.get_rgba("text")
                            size_hint_x: 0.3
                            halign: 'right'
                            valign: 'middle'
                            text_size: self.size
                        
                        Spinner:
                            id: theme_spinner
                            text: root.current_theme
                            values: ["minecraft"]
                            font_size: '14sp'
                            font_name: app.theme_manager.get_font("main")
                            color: app.theme_manager.get_rgba("text")
                            background_normal: app.theme_manager.get_image("button_bg")
                            background_down: app.theme_manager.get_image("button_bg_active")
                            size_hint_x: 0.7
                            on_text: root.on_theme_select(self.text)
                    
                    BoxLayout:
                        orientation: 'horizontal'
                        spacing: dp(8)
                        size_hint_y: None
                        height: dp(32)
                        
                        Label:
                            id: variant_label
                            text: "Mode:"
                            font_size: '14sp'
                            font_name: app.theme_manager.get_font("main")
                            color: app.theme_manager.get_rgba("text")
                            size_hint_x: 0.3
                            halign: 'right'
                            valign: 'middle'
                            text_size: self.size
                        
                        Spinner:
                            id: variant_spinner
                            text: root.current_variant
                            values: ["light", "dark"]
                            font_size: '14sp'
                            font_name: app.theme_manager.get_font("main")
                            color: app.theme_manager.get_rgba("text")
                            background_normal: app.theme_manager.get_image("button_bg")
                            background_down: app.theme_manager.get_image("button_bg_active")
                            size_hint_x: 0.7
                            on_text: root.on_variant_select(self.text)
            
            # Настройки языка
            OverlayCard:
                size_hint_x: 0.4
                padding: [dp(16), dp(12)]
                
                BoxLayout:
                    orientation: 'vertical'
                    spacing: dp(8)
                    
                    Label:
                        id: language_section_label
                        text: "Language"
                        font_size: '18sp'
                        font_name: app.theme_manager.get_font("title")
                        color: app.theme_manager.get_rgba("primary")
                        size_hint_y: None
                        height: dp(24)
                        halign: 'center'
                        valign: 'middle'
                        text_size: self.size
                    
                    BoxLayout:
                        orientation: 'horizontal'
                        spacing: dp(8)
                        size_hint_y: None
                        height: dp(32)
                        
                        # Label:
                        #     id: language_label
                        #     text: "Language:"
                        #     font_size: '14sp'
                        #     font_name: app.theme_manager.get_font("main")
                        #     color: app.theme_manager.get_rgba("text")
                        #     size_hint_x: 0.4
                        #     halign: 'right'
                        #     valign: 'middle'
                        #     text_size: self.size
                        
                        Spinner:
                            id: language_spinner
                            text: root.current_language
                            values: ["en", "ru"]
                            font_size: '14sp'
                            font_name: app.theme_manager.get_font("main")
                            color: app.theme_manager.get_rgba("text")
                            background_normal: app.theme_manager.get_image("button_bg")
                            background_down: app.theme_manager.get_image("button_bg_active")
                            size_hint_x: 0.6
                            on_text: root.on_language_select(self.text)
                    
                    # Заполнитель
                    Widget:

        # Средний ряд: Пользователь и Автотема
        BoxLayout:
            orientation: 'horizontal'
            spacing: dp(16)
            size_hint_y: None
            height: dp(136)
            
            # Настройки пользователя
            OverlayCard:
                size_hint_x: 0.6
                padding: [dp(16), dp(12)]
                
                BoxLayout:
                    orientation: 'vertical'
                    spacing: dp(8)
                    
                    Label:
                        id: user_section_label
                        text: "User Settings"
                        font_size: '18sp'
                        font_name: app.theme_manager.get_font("title")
                        color: app.theme_manager.get_rgba("primary")
                        size_hint_y: None
                        height: dp(24)
                        halign: 'center'
                        valign: 'middle'
                        text_size: self.size
                    
                    BoxLayout:
                        orientation: 'horizontal'
                        spacing: dp(8)
                        size_hint_y: None
                        height: dp(32)
                        
                        Label:
                            id: username_label
                            text: "Name:"
                            font_size: '14sp'
                            font_name: app.theme_manager.get_font("main")
                            color: app.theme_manager.get_rgba("text")
                            size_hint_x: 0.25
                            halign: 'right'
                            valign: 'middle'
                            text_size: self.size
                        
                        TextInput:
                            id: username_input
                            text: root.username
                            font_size: '14sp'
                            font_name: app.theme_manager.get_font("main")
                            foreground_color: app.theme_manager.get_rgba("text")
                            background_color: app.theme_manager.get_rgba("overlay_card")
                            size_hint_x: 0.75
                            multiline: False
                            height: dp(32)
                    
                    BoxLayout:
                        orientation: 'horizontal'
                        spacing: dp(4)
                        size_hint_y: None
                        height: dp(32)
                        
                        Label:
                            id: birthday_label
                            text: "Birth:"
                            font_size: '14sp'
                            font_name: app.theme_manager.get_font("main")
                            color: app.theme_manager.get_rgba("text")
                            size_hint_x: 0.25
                            halign: 'right'
                            valign: 'middle'
                            text_size: self.size
                        
                        TextInput:
                            id: birth_day_input
                            text: root.birth_day
                            font_size: '14sp'
                            font_name: app.theme_manager.get_font("main")
                            foreground_color: app.theme_manager.get_rgba("text")
                            background_color: app.theme_manager.get_rgba("overlay_card")
                            size_hint_x: 0.15
                            multiline: False
                            input_filter: "int"
                            height: dp(32)
                        
                        Label:
                            text: "/"
                            font_size: '14sp'
                            color: app.theme_manager.get_rgba("text")
                            size_hint_x: 0.05
                            halign: 'center'
                        
                        TextInput:
                            id: birth_month_input
                            text: root.birth_month
                            font_size: '14sp'
                            font_name: app.theme_manager.get_font("main")
                            foreground_color: app.theme_manager.get_rgba("text")
                            background_color: app.theme_manager.get_rgba("overlay_card")
                            size_hint_x: 0.15
                            multiline: False
                            input_filter: "int"
                            height: dp(32)
                        
                        Label:
                            text: "/"
                            font_size: '14sp'
                            color: app.theme_manager.get_rgba("text")
                            size_hint_x: 0.05
                            halign: 'center'
                        
                        TextInput:
                            id: birth_year_input
                            text: root.birth_year
                            font_size: '14sp'
                            font_name: app.theme_manager.get_font("main")
                            foreground_color: app.theme_manager.get_rgba("text")
                            background_color: app.theme_manager.get_rgba("overlay_card")
                            size_hint_x: 0.3
                            multiline: False
                            input_filter: "int"
                            height: dp(32)
                    
                    # Заполнитель
                    Widget:
            
            # Автоматическая тема
            OverlayCard:
                size_hint_x: 0.4
                padding: [dp(16), dp(12)]
                
                BoxLayout:
                    orientation: 'vertical'
                    spacing: dp(8)
                    
                    Label:
                        id: auto_theme_section_label
                        text: "Auto Theme"
                        font_size: '18sp'
                        font_name: app.theme_manager.get_font("title")
                        color: app.theme_manager.get_rgba("primary")
                        size_hint_y: None
                        height: dp(24)
                        halign: 'center'
                        valign: 'middle'
                        text_size: self.size
                    
                    BoxLayout:
                        orientation: 'horizontal'
                        spacing: dp(8)
                        size_hint_y: None
                        height: dp(32)
                        
                        Label:
                            id: auto_theme_label
                            text: "Auto:"
                            font_size: '14sp'
                            font_name: app.theme_manager.get_font("main")
                            color: app.theme_manager.get_rgba("text")
                            size_hint_x: 0.4
                            halign: 'right'
                            valign: 'middle'
                            text_size: self.size
                        
                        Button:
                            id: auto_theme_button
                            text: "ON" if root.auto_theme_enabled else "OFF"
                            font_size: '14sp'
                            font_name: app.theme_manager.get_font("main")
                            color: app.theme_manager.get_rgba("primary") if root.auto_theme_enabled else app.theme_manager.get_rgba("text_secondary")
                            background_normal: app.theme_manager.get_image("button_bg")
                            background_down: app.theme_manager.get_image("button_bg_active")
                            size_hint_x: 0.6
                            disabled: not root.light_sensor_available
                            opacity: 1.0 if root.light_sensor_available else 0.5
                            on_release: root.toggle_auto_theme()
                    
                    BoxLayout:
                        orientation: 'horizontal'
                        spacing: dp(4)
                        size_hint_y: None
                        height: dp(24)
                        
                        Label:
                            id: threshold_label
                            text: "Delay:"
                            font_size: '12sp'
                            font_name: app.theme_manager.get_font("main")
                            color: app.theme_manager.get_rgba("text_secondary")
                            size_hint_x: 0.3
                            halign: 'right'
                            valign: 'middle'
                            text_size: self.size
                        
                        Slider:
                            id: threshold_slider
                            min: 1
                            max: 5
                            value: root.light_sensor_threshold
                            step: 1
                            size_hint_x: 0.5
                            disabled: not root.light_sensor_available
                            on_value: root.on_threshold_change(self.value)
                        
                        Label:
                            text: f"{int(root.light_sensor_threshold)}s"
                            font_size: '12sp'
                            font_name: app.theme_manager.get_font("main")
                            color: app.theme_manager.get_rgba("text_secondary")
                            size_hint_x: 0.2
                            halign: 'center'
                            valign: 'middle'
                    
                    Label:
                        id: sensor_status_label
                        text: root.current_light_status
                        font_size: '10sp'
                        font_name: app.theme_manager.get_font("main")
                        color: app.theme_manager.get_rgba("text_secondary")
                        size_hint_y: None
                        height: dp(16)
                        halign: 'center'
                        valign: 'middle'
                        text_size: self.size

        # Нижний ряд: Кнопки управления
        OverlayCard:
            size_hint_y: None
            height: dp(64)
            padding: [dp(16), dp(8)]
            
            BoxLayout:
                orientation: 'horizontal'
                spacing: dp(16)
                
                Button:
                    id: test_button
                    text: "Test Theme"
                    font_size: '16sp'
                    font_name: app.theme_manager.get_font("main")
                    color: app.theme_manager.get_rgba("text")
                    background_normal: app.theme_manager.get_image("button_bg")
                    background_down: app.theme_manager.get_image("button_bg_active")
                    size_hint_x: 0.3
                    on_release: root.test_theme_switch()
                
                Widget:
                    # Заполнитель для центрирования
                    size_hint_x: 0.4
                
                Button:
                    id: save_button
                    text: "Save Settings"
                    font_size: '16sp'
                    font_name: app.theme_manager.get_font("main")
                    color: app.theme_manager.get_rgba("primary")
                    background_normal: app.theme_manager.get_image("button_bg")
                    background_down: app.theme_manager.get_image("button_bg_active")
                    size_hint_x: 0.3
                    on_release: root.save_all_settings()