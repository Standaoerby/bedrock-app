# üéß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Waveshare WM8960 Audio Board –¥–ª—è Bedrock 2.0

## ‚úÖ –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å
–ü–æ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–µ –≤–∏–¥–Ω–æ —á—Ç–æ **WM8960 –∞—É–¥–∏–æ-–ø–ª–∞—Ç–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ**:
- –û–±–Ω–∞—Ä—É–∂–µ–Ω–∞ –∫–∞–∫ `wm8960soundcard` (card 0)
- –î–æ—Å—Ç—É–ø–Ω—ã –º–∏–∫—Å–µ—Ä—ã: Headphone, Speaker, Playbook –∏ –¥—Ä—É–≥–∏–µ
- –ó–≤—É–∫ —Å–ª—ã—à–Ω–æ (–ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º)

## üîß –ù–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤ Bedrock 2.0

### 1. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ AudioService
–í —Ñ–∞–π–ª–µ `services/audio_service.py` –Ω—É–∂–Ω–æ:
- –î–æ–±–∞–≤–∏—Ç—å `'wm8960-soundcard'` (—Å –¥–µ—Ñ–∏—Å–æ–º) –≤ —Å–ø–∏—Å–æ–∫ –ø–æ–∏—Å–∫–∞
- –£–≤–µ–ª–∏—á–∏—Ç—å buffer size –¥–æ 2048 –¥–ª—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏ I2S
- –î–æ–±–∞–≤–∏—Ç—å —Å–ø–µ—Ü–∏–∞–ª—å–Ω—É—é –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É –¥–ª—è WM8960

### 2. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ VolumeService  
–í —Ñ–∞–π–ª–µ `services/volume_service.py` –Ω—É–∂–Ω–æ:
- –û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã –º–∏–∫—Å–µ—Ä–æ–≤: `Headphone`, `Speaker`, `Playbook` –≤ –Ω–∞—á–∞–ª–æ —Å–ø–∏—Å–∫–∞
- –î–æ–±–∞–≤–∏—Ç—å —Å–ø–µ—Ü–∏–∞–ª—å–Ω—É—é –ª–æ–≥–∏–∫—É –¥–ª—è WM8960 –º–∏–∫—Å–µ—Ä–æ–≤
- –£–ª—É—á—à–∏—Ç—å –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

## üöÄ –ë—ã—Å—Ç—Ä–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–∞—Ç—á
```bash
# –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç apply_wm8960_patches.sh –≤ –ø–∞–ø–∫—É Bedrock
chmod +x apply_wm8960_patches.sh
./apply_wm8960_patches.sh
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –†—É—á–Ω–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ
1. –ó–∞–º–µ–Ω–∏—Ç–µ –º–µ—Ç–æ–¥—ã –≤ `services/audio_service.py` –Ω–∞ –≤–µ—Ä—Å–∏–∏ –∏–∑ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–∞
2. –ó–∞–º–µ–Ω–∏—Ç–µ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã –≤ `services/volume_service.py` –Ω–∞:
```python
MIXER_PRIORITIES = [
    'Headphone',    # WM8960 –æ—Å–Ω–æ–≤–Ω–æ–π –≤—ã—Ö–æ–¥
    'Speaker',      # WM8960 –¥–∏–Ω–∞–º–∏–∫–∏  
    'Playbook',     # WM8960 –æ–±—â–∏–π –ø–ª–µ–π–±—ç–∫
    'Master', 'PCM', 'Digital', 'Line Out'
]
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### 1. –ë—ã—Å—Ç—Ä—ã–π —Ç–µ—Å—Ç –∞–ø–ø–∞—Ä–∞—Ç—É—Ä—ã
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞—É–¥–∏–æ –∫–∞—Ä—Ç
aplay -l | grep wm8960

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–∏–∫—Å–µ—Ä–æ–≤
amixer scontrols | grep -E "(Headphone|Speaker|Playbook)"

# –¢–µ—Å—Ç –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è (–µ—Å–ª–∏ –µ—Å—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π —Ñ–∞–π–ª)
speaker-test -c 2 -r 44100 -t wav -D hw:0,0
```

### 2. –¢–µ—Å—Ç Bedrock —Å–µ—Ä–≤–∏—Å–æ–≤
```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç-—Å–∫—Ä–∏–ø—Ç
python3 test_wm8960.py
```

### 3. –ü–æ–ª–Ω—ã–π —Ç–µ—Å—Ç –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏
1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ Bedrock: `python3 main.py`
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (Settings)
3. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∫–Ω–æ–ø–∫–∏ VOL+ / VOL- 
4. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ —ç–∫—Ä–∞–Ω –±—É–¥–∏–ª—å–Ω–∏–∫–∞ (Alarm)
5. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –º–µ–ª–æ–¥–∏–∏

## üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º

### –ï—Å–ª–∏ –Ω–µ—Ç –∑–≤—É–∫–∞:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –¥–∏–Ω–∞–º–∏–∫–æ–≤/–Ω–∞—É—à–Ω–∏–∫–æ–≤ –∫ WM8960
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —É—Ä–æ–≤–Ω–∏ –º–∏–∫—Å–µ—Ä–æ–≤:
```bash
amixer get Headphone
amixer get Speaker  
amixer get Playbook
```
3. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≥—Ä–æ–º–∫–æ—Å—Ç—å:
```bash
amixer set Headphone 80%
amixer set Speaker 80%
```

### –ï—Å–ª–∏ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≥—Ä–æ–º–∫–æ—Å—Ç—å—é:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ –º–∏–∫—Å–µ—Ä—ã: `amixer scontrols`
2. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –º–∏–∫—Å–µ—Ä—ã –Ω–µ –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ "off"
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ Bedrock –¥–ª—è –æ—à–∏–±–æ–∫ VolumeService

### –ï—Å–ª–∏ pygame –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è:
1. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –±–∏–±–ª–∏–æ—Ç–µ–∫–∏: `pip install pygame`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ ALSA —Ä–∞–±–æ—Ç–∞–µ—Ç: `python3 -c "import alsaaudio; print(alsaaudio.cards())"`
3. –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ Raspberry Pi –ø–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –¥—Ä–∞–π–≤–µ—Ä–æ–≤

## üìã –î–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

### –í–∞—à–∞ —Ç–µ–∫—É—â–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:
- **–ê—É–¥–∏–æ –∫–∞—Ä—Ç–∞**: `wm8960soundcard` (card 0)
- **–£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ**: `hw:0,0`
- **–î–æ—Å—Ç—É–ø–Ω—ã–µ –º–∏–∫—Å–µ—Ä—ã**: Headphone, Speaker, Playbook –∏ –¥—Ä—É–≥–∏–µ
- **–°—Ç–∞—Ç—É—Å**: –ó–≤—É–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç ‚úÖ

### –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ /boot/config.txt:
```
# –ï—Å–ª–∏ —É –≤–∞—Å Waveshare WM8960 Audio Board
dtoverlay=wm8960-soundcard
```

## üéØ –û–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:

1. ‚úÖ **AudioService** –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–±–Ω–∞—Ä—É–∂–∏—Ç WM8960 –∫–∞–∫ `hw:0,0`
2. ‚úÖ **VolumeService** –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–∏–∫—Å–µ—Ä `Headphone` –∏–ª–∏ `Speaker`
3. ‚úÖ **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≥—Ä–æ–º–∫–æ—Å—Ç—å—é** —á–µ—Ä–µ–∑ –∫–Ω–æ–ø–∫–∏ VOL+/VOL- –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö
4. ‚úÖ **–í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –∑–≤—É–∫–æ–≤** —Ç–µ–º—ã (–∫–ª–∏–∫–∏, —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è)
5. ‚úÖ **–í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –º–µ–ª–æ–¥–∏–π** –±—É–¥–∏–ª—å–Ω–∏–∫–∞
6. ‚úÖ **–ê–ø–ø–∞—Ä–∞—Ç–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ –≥—Ä–æ–º–∫–æ—Å—Ç–∏** (–µ—Å–ª–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω—ã –∫ GPIO 23/24)

## üèÅ –ü–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ Bedrock –∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –≤ –ª–æ–≥–∞—Ö —Å–æ–æ–±—â–µ–Ω–∏—è —Ç–∏–ø–∞:
```
AudioService initialized with WM8960 Audio Board: hw:0,0
VolumeService: Selected mixer: Headphone
```

–ï—Å–ª–∏ –≤–∏–¥–∏—Ç–µ —Ç–∞–∫–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è - –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ! üéâ